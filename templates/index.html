<!--

Steps:
Create a javascript function in script tag that posts an xmlhttprequest to /picture

In onclick handler, call that function

In flask, handle that request by calling Liam's code to get a picture

Base64 encode that data and return it

Take the base64 response and unbase64 it in another javascript function

Do the meme transformations

Base64 encode it again

Put that data as the data of an html <img> tag. It knows how to display base64 data

-->
<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Meme Faceâ€‘Cam</title>
</head>
<body>
  <p>Point the camera to your face and take a picture when you're ready</p>

  <button id="snapBtn">Take Picture</button>
  <img id="resultImg" alt="Result will appear here">

  <script>
    function postPicture() {
      const xhr = new XMLHttpRequest();
      xhr.open('GET', '/picture');
      xhr.responseType = 'blob';

      xhr.onload = function () {
        if (xhr.status === 200) {
          const blob = xhr.response;
          const reader = new FileReader();
          reader.onloadend = function () {
            const base64Data = reader.result;
            const img = new Image();
            img.onload = function () {
              const canvas = document.createElement('canvas');
              canvas.width = img.width;
              canvas.height = img.height + 30;
              const ctx = canvas.getContext('2d');
              ctx.drawImage(img, 0, 0);
              ctx.font = '20px sans-serif';
              ctx.fillStyle = '#fff';
              ctx.fillText('Meme', 10, canvas.height - 10);
              canvas.toBlob(function (blob) {
                const finalURL = URL.createObjectURL(blob);
                const imgElement = document.getElementById('resultImg');
                imgElement.src = finalURL;
                URL.revokeObjectURL(finalURL);
              }, 'image/png');
            };
            img.src = base64Data;
          };
          reader.readAsDataURL(blob);
        } else {
          console.error('Failed to fetch picture:', xhr.status);
        }
      };
      xhr.onerror = function () {
        console.error('Network error while fetching /picture');
      };
      xhr.send();
    }
    document.getElementById('snapBtn').addEventListener('click', postPicture);
  </script>
</body>
</html>